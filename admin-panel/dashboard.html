<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | Lagnam Admin</title>
  <link rel="stylesheet" href="css/admin.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <svg viewBox="0 0 24 24" fill="currentColor" class="logo-icon">
            <path
              d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
          </svg>
        </div>
        <h2>Lagnam</h2>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Main</div>
          <a href="dashboard.html" class="nav-link active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            Dashboard
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Management</div>
          <a href="users.html" class="nav-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            Users
            <span class="badge" id="usersBadge">0</span>
          </a>
          <a href="connections.html" class="nav-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path
                d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
              </path>
            </svg>
            Connections
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Settings</div>
          <a href="#" class="nav-link" onclick="showChangePassword()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
              </path>
            </svg>
            Change Password
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="admin-info">
          <div class="admin-avatar" id="adminAvatar">A</div>
          <div class="admin-details">
            <div class="admin-name" id="adminName">Admin</div>
            <div class="admin-role" id="adminRole">admin</div>
          </div>
        </div>
        <button class="btn btn-secondary btn-full" onclick="logout()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          Logout
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="page-header">
        <div>
          <h1 class="page-title">Dashboard</h1>
          <p class="page-subtitle">Welcome back! Here's what's happening today.</p>
        </div>
        <button class="btn btn-primary" onclick="window.location.href='users.html'">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
          </svg>
          Manage Users
        </button>
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid" id="statsGrid">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon users">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
            </div>
          </div>
          <div class="stat-value" id="totalUsers">-</div>
          <div class="stat-label">Total Users</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon verified">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
            </div>
          </div>
          <div class="stat-value" id="verifiedUsers">-</div>
          <div class="stat-label">Verified Users</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon connections">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path
                  d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                </path>
              </svg>
            </div>
          </div>
          <div class="stat-value" id="totalConnections">-</div>
          <div class="stat-label">Matches Made</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon new">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </div>
          </div>
          <div class="stat-value" id="newUsersToday">-</div>
          <div class="stat-label">New Today</div>
        </div>
      </div>

      <!-- Quick Stats Row -->
      <div class="stats-grid" style="margin-bottom: 32px;">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon" style="background: rgba(103, 58, 183, 0.1); color: #673AB7;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
            </div>
          </div>
          <div class="stat-value" id="activeUsers">-</div>
          <div class="stat-label">Active Users</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon" style="background: rgba(0, 188, 212, 0.1); color: #00BCD4;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
              </svg>
            </div>
          </div>
          <div class="stat-value" id="newUsersMonth">-</div>
          <div class="stat-label">New This Month</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon" style="background: rgba(33, 150, 243, 0.1); color: #2196F3;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2z" />
                <path d="M15 9l-3 3-3-3" />
              </svg>
            </div>
          </div>
          <div class="stat-value" id="maleUsers">-</div>
          <div class="stat-label">Male Users</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon" style="background: rgba(233, 30, 99, 0.1); color: #E91E63;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="8" r="5"></circle>
                <path d="M12 13v8"></path>
                <path d="M9 18h6"></path>
              </svg>
            </div>
          </div>
          <div class="stat-value" id="femaleUsers">-</div>
          <div class="stat-label">Female Users</div>
        </div>
      </div>

      <!-- Recent Users -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Recent Users</h3>
          <a href="users.html" class="btn btn-secondary btn-sm">View All</a>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>User</th>
                <th>Gender</th>
                <th>Status</th>
                <th>Verified</th>
                <th>Joined</th>
              </tr>
            </thead>
            <tbody id="recentUsersTable">
              <tr>
                <td colspan="5" class="loading">
                  <div class="spinner"></div>
                  Loading...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <script src="js/admin.js"></script>
  <script>
    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', () => {
      checkAuth();
      loadStats();
      loadRecentUsers();
    });

    // Load dashboard statistics
    async function loadStats() {
      try {
        const stats = await api('/stats');

        document.getElementById('totalUsers').textContent = stats.users.total;
        document.getElementById('verifiedUsers').textContent = stats.users.verified;
        document.getElementById('totalConnections').textContent = stats.connections.accepted;
        document.getElementById('newUsersToday').textContent = stats.users.newToday;
        document.getElementById('activeUsers').textContent = stats.users.active;
        document.getElementById('newUsersMonth').textContent = stats.users.newThisMonth;
        document.getElementById('maleUsers').textContent = stats.users.male;
        document.getElementById('femaleUsers').textContent = stats.users.female;
        document.getElementById('usersBadge').textContent = stats.users.total;
      } catch (error) {
        showToast('error', 'Failed to load statistics');
      }
    }

    // Load recent users
    async function loadRecentUsers() {
      try {
        const data = await api('/users?limit=5');
        const tbody = document.getElementById('recentUsersTable');

        if (data.users.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="5" class="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                </svg>
                <h3>No users yet</h3>
                <p>Users will appear here once they register.</p>
              </td>
            </tr>
          `;
          return;
        }

        tbody.innerHTML = data.users.map(user => `
          <tr>
            <td>
              <div class="user-info">
                <div class="user-avatar">${(user.basicInfo?.name || user.email)[0].toUpperCase()}</div>
                <div class="user-details">
                  <span class="user-name">${user.basicInfo?.name || 'Not set'}</span>
                  <span class="user-email">${user.email}</span>
                </div>
              </div>
            </td>
            <td>${capitalize(user.basicInfo?.gender || 'Not set')}</td>
            <td>
              <span class="badge ${user.isActive ? 'badge-success' : 'badge-error'}">
                ${user.isActive ? 'Active' : 'Inactive'}
              </span>
            </td>
            <td>
              <span class="badge ${user.isVerified ? 'badge-success' : 'badge-warning'}">
                ${user.isVerified ? 'Verified' : 'Pending'}
              </span>
            </td>
            <td>${formatDate(user.createdAt)}</td>
          </tr>
        `).join('');
      } catch (error) {
        showToast('error', 'Failed to load users');
      }
    }
  </script>
</body>

</html>