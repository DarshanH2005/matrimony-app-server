<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Login | Matrimony App</title>
    <link rel="stylesheet" href="css/admin.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="login-page">
    <div class="login-container">
      <!-- Logo & Branding -->
      <div class="login-header">
        <div class="logo">
          <svg viewBox="0 0 24 24" fill="currentColor" class="logo-icon">
            <path
              d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
            />
          </svg>
        </div>
        <h1>Matrimony Admin</h1>
        <p>Sign in to access the admin dashboard</p>
      </div>

      <!-- Login Form -->
      <form id="loginForm" class="login-form">
        <div class="input-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="admin@matrimony.com"
            required
          />
        </div>

        <div class="input-group">
          <label for="password">Password</label>
          <div class="password-wrapper">
            <input
              type="password"
              id="password"
              name="password"
              placeholder="••••••••"
              required
            />
            <button
              type="button"
              class="toggle-password"
              onclick="togglePassword()"
            >
              <svg
                id="eyeIcon"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </button>
          </div>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <button type="submit" class="btn btn-primary btn-full" id="loginBtn">
          <span>Sign In</span>
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M5 12h14M12 5l7 7-7 7" />
          </svg>
        </button>
      </form>

      <!-- Footer -->
      <div class="login-footer">
        <p>&copy; 2024 Matrimony App. All rights reserved.</p>
      </div>
    </div>

    <script>
      const API_BASE = "/api/admin";

      // Check if already logged in
      if (localStorage.getItem("adminToken")) {
        window.location.href = "dashboard.html";
      }

      // Toggle password visibility
      function togglePassword() {
        const passwordInput = document.getElementById("password");
        const eyeIcon = document.getElementById("eyeIcon");

        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          eyeIcon.innerHTML =
            '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
        } else {
          passwordInput.type = "password";
          eyeIcon.innerHTML =
            '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
        }
      }

      // Handle login form submission
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;
          const loginBtn = document.getElementById("loginBtn");
          const errorMessage = document.getElementById("errorMessage");

          // Clear previous error
          errorMessage.textContent = "";
          errorMessage.style.display = "none";

          // Show loading state
          loginBtn.disabled = true;
          loginBtn.innerHTML = '<span class="spinner"></span> Signing in...';

          try {
            const response = await fetch(`${API_BASE}/login`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ email, password }),
            });

            const data = await response.json();

            if (data.success) {
              // Save token and admin info
              localStorage.setItem("adminToken", data.data.token);
              localStorage.setItem(
                "adminInfo",
                JSON.stringify(data.data.admin),
              );

              // Redirect to dashboard
              window.location.href = "dashboard.html";
            } else {
              throw new Error(data.message || "Login failed");
            }
          } catch (error) {
            errorMessage.textContent = error.message;
            errorMessage.style.display = "block";

            // Reset button
            loginBtn.disabled = false;
            loginBtn.innerHTML =
              '<span>Sign In</span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
          }
        });
    </script>
  </body>
</html>
